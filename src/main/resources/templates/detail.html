#parse("header.html")
<link rel="stylesheet" href="/../styles/detail.css">
<div class="zg-wrap zu-main clearfix with-indention-votebar" itemscope="" itemtype="http://schema.org/Question"
     id="zh-single-question-page" data-urltoken="36301524" role="main">
    <div class="zu-main-content">
        <div class="avatar_user_imag">
            <a title="$!{vo.user.name}" data-tip="p$t$amuro1230" class="zm-item-link-avatar" target="_blank" href="/user/$!{question.userId}">
                <img src=$!{question.userImga} class="zm-item-img-avatar" style="height: 50px;width: 50px"></a>
        </div>
        <div class="zu-main-content-inner">
            <meta itemprop="isTopQuestion" content="false">
            <meta itemprop="visitsCount" content="402">
            <!--
            <div class="zm-tag-editor zg-section">
                <div class="zm-tag-editor-labels zg-clear">
                    <a data-tip="t$b$19550730" class="zm-item-tag" href="">新浪微博</a>
                    <a data-tip="t$b$19554412" class="zm-item-tag" href="">网络营销</a>
                    <a data-tip="t$b$19559739" class="zm-item-tag" href="">微博粉丝</a>
                    <a data-tip="t$b$19560290" class="zm-item-tag" href="">僵尸粉</a>
                    <a data-tip="t$b$19565757" class="zm-item-tag" href="">网络水军</a>
                    <a href="javascript:;" class="zu-edit-button" name="edit">
                        <i class="zu-edit-button-icon"></i>修改</a>
                </div>
            </div>
            -->
            <div id="zh-question-title" data-editable="true" class="zm-editable-status-normal">
                <h2 class="zm-item-title">

                    <span class="zm-editable-content">$!{question.title}</span>

                </h2>
            </div>
            <div id="zh-question-detail" class="zm-item-rich-text zm-editable-status-normal">
                <div class="zm-editable-content">$!{question.content}</div>
            </div>
            <div class="zm-side-section">
                <div class="zm-side-section-inner" id="zh-question-side-header-wrap">
                    #if ($followed)
                    <button class="follow-button zg-follow zg-btn-white js-follow-question" data-id="${question.id}"
                            data-status="1">
                        取消关注
                    </button>
                    #else
                    <button class="follow-button zg-follow zg-btn-green js-follow-question" data-id="${question.id}">
                        关注微博
                    </button>
                    #end
                    <div class="zh-question-followers-sidebar">
                        <div class="zg-gray-normal">
                            <a href="javascript:void(0);"><strong class="js-user-count">${followUsers.size()}</strong></a>人关注该问题
                        </div>
                        <div class="list zu-small-avatar-list zg-clear js-user-list">
                            #foreach($vo in $followUsers)
                            <a class="zm-item-link-avatar js-user-${vo.id}" href="/user/${vo.id}"
                               data-original_title="${vo.name}">
                                <img src="${vo.headUrl}"
                                     class="zm-item-img-avatar"></a>
                            #end
                        </div>
                    </div>
                </div>
            </div>
            <div id="zh-question-answer-wrap" data-pagesize="10" class="zh-question-answer-wrapper navigable"
                 data-widget="navigable" data-navigable-options="{&quot;items&quot;: &quot;&gt;.zm-item-answer&quot;}"
                 data-init="{&quot;params&quot;: {&quot;url_token&quot;: 36301524, &quot;pagesize&quot;: 10, &quot;offset&quot;: 0}, &quot;nodename&quot;: &quot;QuestionAnswerListV2&quot;}">

                #foreach($comment in $comments)
                <div class="zm-item-answer  zm-item-expanded js-comment">
                    <link itemprop="url" href="">
                    <meta itemprop="answer-id" content="22162611">
                    <meta itemprop="answer-url-token" content="66862039">
                    <a class="zg-anchor-hidden" name="answer-22162611"></a>

                    <div class="zm-votebar goog-scrollfloater js-vote" data-id="$!{comment.comment.id}">
                        #if($comment.liked > 0)
                        <button class="up js-like pressed" title="赞同"/>
                        #else
                        <button class="up js-like" title="赞同">
                        #end
                            <i class="icon vote-arrow"></i>
                            <span class="count js-voteCount">$!{comment.likeCount}</span>
                            <span class="label sr-only">赞同</span>
                        </button>

                        #if($comment.liked < 0)
                        <button class="down js-dislike pressed" title="反对，不会显示你的姓名"/>
                        #else
                        <button class="down js-dislike" title="反对，不会显示你的姓名">
                        #end
                            <i class="icon vote-arrow"></i>
                            <span class="label sr-only">反对，不会显示你的姓名</span>
                        </button>
                    </div>
                    <div class="answer-head">
                        <div class="zm-item-answer-author-info">
                            <a class="zm-item-link-avatar avatar-link" href="/user/${comment.user.id}" target="_blank" data-tip="p$t$yingxiaodao">
                                <img src="${comment.user.headUrl}" class="zm-list-avatar avatar"></a>
                            <a class="author-link" data-tip="p$t$yingxiaodao" target="_blank" href="/user/${comment.user.id}">$comment.user.name</a>
                        </div>
                        <div class="zm-item-vote-info">
                                <span class="voters text">
                                    <a href="" class="more text"><span class="js-voteCount">$!{comment.likeCount}</span>&nbsp;人赞同</a>
                                </span>
                        </div>
                    </div>
                    <div class="zm-item-rich-text expandable js-collapse-body" data-resourceid="6727688" data-action="/answer/content" data-author-name="营销岛" data-entry-url="/question/36301524/answer/66862039">

                        <div class="zm-editable-content clearfix">
                            $comment.comment.content
                        </div>
                    </div>
                    <a class="zg-anchor-hidden ac" name="22162611-comment"></a>
                    <div class="zm-item-meta answer-actions clearfix js-contentActions">
                        <div class="zm-meta-panel">
                            <a itemprop="url" class="answer-data-link meta-item" target="_blank" href="">发布于 $data.format('yyyy-MM-dd HH:mm:ss', $comment.comment.createdDate)</a>
                            &nbsp;&nbsp;<a href="javascript:;" onclick="commentTo('回复${comment.user.name}','$!{question.id}','${comment.comment.id}','${comment.user.id}')" >回复</a>&nbsp;&nbsp;
                            #if($comment.user.id==$user.id)
                                <a href="javascript:;" id="edit_comment" onclick="editComment('${comment.comment.content}','$!{question.id}','$!{comment.comment.id}')"><span>编辑</span></a>&nbsp;&nbsp;<a class="answer-data-link meta-item" href="/deleteComment?commentId=$!{comment.comment.id}&questionId=$!{question.id}&child=false&parentId=0"><span>删除</span></a>
                            #end
                            <a href="javascript:;" onclick="commentToComment(this,'$!{comment.comment.id}','$!{question.id}')"><span class="commentNum">$comment.comment.count条回复</span></a>
                        </div>
                    </div>
                    <div class="Comment-comment">
                        <div id="Usercommentss" style="width: auto;height: auto;"></div>
                        #if($comment.comment.count>0)
                            <div class="commentHidden" onclick="hiddenDiv(this)"><a href="javascript:;">收起</a></div>
                        #end
                    </div>
                </div>
                #end
            </div>
            <a name="draft"></a>

            <form action="/addComment" method="post">
                <input type="hidden" name="questionId" value="$!{question.id}"/>
                <input type="hidden" name="parentId" value="0"/>
                <input type="hidden" name="toUserId" value="0"/>
            <div id="zh-question-answer-form-wrap" class="zh-question-answer-form-wrap">
                <ul class="pagination">
                    <li>
                        #set($prev = $nextPage - 1)
                        <a href="/question/$!{question.id}/${prev}">Prev</a>
                    </li>
                    #foreach($page in $pageDisplayArray)
                    #set($style="")
                    #if($nextPage == $page)
                    #set($style="style='color:grey'")
                    #end
                    <li>
                        <a href="/question/$!{question.id}/$page" $style>$page</a>
                    </li>
                    #end
                    <li>
                        #set($next = $nextPage + 1)
                        <a href="/question/$!{question.id}/${next}">Next</a>
                    </li>
                </ul>
                <div class="zm-editable-editor-wrap" style="">
                    <div class="zm-editable-editor-outer">
                        <div class="zm-editable-editor-field-wrap">
                            <textarea name="content" id="content" class="zm-editable-editor-field-element editable" style="width:100%;"></textarea>
                        </div>
                    </div>

                    <div class="zm-command clearfix">
                            <span class=" zg-right">
                                <button type="submit" class="submit-button zg-btn-blue">发布回答</button></span>
                    </div>
                </div>
            </div>
            </form>
        </div>
    </div>
</div>
#parse("js.html")
<script type="text/javascript" src="/scripts/main/site/detail.js"></script>
<script type="text/javascript" src="/scripts/dialog-plus.js"></script>
#parse("footer.html")
<script type="text/javascript">
    function editComment(comment,questionid,commentid){
        var d = dialog({
            title: '编辑',
            content: '<div class="zm-editable-editor-outer">'+
            '<div class="zm-editable-editor-field-wrap">'+
            '<textarea name="content" id="comment" class="zm-editable-editor-field-element editable" style="width:100%;">'+comment+'</textarea>'+
            '</div>'+
            '</div>',
            okValue: '确定',
            ok: function () {
                this.title('提交中…');
                $.ajax({url:"/editComment?content="+$('#comment').val()+"&questionId="+questionid+"&commentId="+commentid+"",
                    async:false,
                    success: function(){
                        window.location.reload();
                    }
                }),
                d.remove();
            },
            cancelValue: '取消',
            cancel: function () {}
        });
        d.width(500);
        d.showModal();
    }

    function commentTo(comment ,questionid,parentId,commentUserId){
        var d = dialog({
            title: '回复',
            content: '<div class="zm-editable-editor-outer">'+
            '<div class="zm-editable-editor-field-wrap">'+
            '<textarea placeholder="'+comment+'" id="commentTo" class="zm-editable-editor-field-element editable" style="width:100%;"></textarea>'+
            '</div>'+
            '</div>',
            okValue: '确定',
            ok: function () {
                this.title('提交中…');
                $.ajax({url:"/addComment?content="+$('#commentTo').val()+"&questionId="+questionid+"&parentId="+parentId+"&toUserId="+commentUserId+"",
                    async:false,
                    success: function(){
                        window.location.reload();
                    }
                }),
                d.remove();
            },
            cancelValue: '取消',
            cancel: function () {}
        });
        d.width(500);
        d.showModal();
    }

    function commentToComment(obj,commentId,qid) {
        var divContent = obj.parentNode.parentNode.nextSibling.nextSibling;
        divContent.style.display = "block";
        var ChildDiv = obj.parentNode.parentNode.nextSibling.nextSibling.childNodes[1];
        ChildDiv.innerHTML = "";
        $.ajax(
            {
                url:"/getComment?commentId="+commentId+"&questionId="+qid+"",
                type:"post",
                success: function(data){
                    var jsonObj = eval( '(' + data + ')' );
                    $.each(jsonObj, function() {
                        ChildDiv.innerHTML += "<div><div class='comments-comments'> &nbsp;<a href='/user/"+this.userId+"'>"+this.username+"</a> 回复了 <a href='/user/"+this.toUserId+"'>"+this.tousername +"</a>&nbsp;："+ this.content +
                            "</br><span class='answer-data-link meta-item' >发布于 "+this.createdDate+"&nbsp;&nbsp;</span></div>";
                            if(this.userId==$user.id){
                                ChildDiv.innerHTML+= "<div class='delete-comment'><a href='javascript:;' onclick=commentTo('回复"+this.username+"','"+qid+"','"+commentId+"','"+this.userId+"')>回复</a>" +
                                    "&nbsp;&nbsp;<a href='/deleteComment?commentId="+this.id+"&questionId="+qid+"&child=true&parentId="+commentId+"' >删除</a></div>";
                            }else{
                                ChildDiv.innerHTML+= "<div class='delete-comment'><a href='javascript:;' onclick=commentTo('回复"+this.username+"','"+qid+"','"+commentId+"','"+this.userId+"')>回复</a></div>";
                            }
                        ChildDiv.innerHTML +="</div>"
                    });
            }
        });
    }

    function hiddenDiv(obj) {
        obj.parentNode.style.display = "none";
    }

</script>